<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate Lite Config Editor</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
    const { useState, useEffect } = React;

    let authToken = null;

    // Minimal Icons
    const Plus = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
    const Trash2 = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
    const Save = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>;
    const RefreshCw = ({ className = "" }) => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>;
    const ChevronDown = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="6 9 12 15 18 9"/></svg>;
    const Lock = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
    const LogOut = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;

    function LoginScreen({ onLogin }) {
        const [password, setPassword] = useState('');
        const [error, setError] = useState('');
        const [loading, setLoading] = useState(false);

        const handleSubmit = async (e) => {
            e.preventDefault();
            setLoading(true);
            setError('');

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    onLogin();
                } else {
                    setError('Invalid password');
                }
            } catch (err) {
                setError('Connection error');
            }
            setLoading(false);
        };

        return (
            <div className="min-h-screen bg-black flex items-center justify-center p-6">
                <div className="w-full max-w-md">
                    <div className="bg-neutral-900 rounded-lg p-8 border border-neutral-800">
                        <div className="flex justify-center mb-6">
                            <div className="w-16 h-16 bg-neutral-800 rounded-full flex items-center justify-center">
                                <Lock />
                            </div>
                        </div>
                        <h1 className="text-2xl font-bold text-center mb-2 text-white">Gate Config</h1>
                        <p className="text-neutral-500 text-center mb-6 text-sm">Authentication Required</p>

                        <form onSubmit={handleSubmit}>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="Password"
                                className="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:border-neutral-600 text-white mb-4"
                                autoFocus
                            />

                            {error && (
                                <div className="mb-4 p-3 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-400 text-sm">
                                    {error}
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={loading || !password}
                                className="w-full py-3 bg-neutral-700 hover:bg-neutral-600 disabled:bg-neutral-800 text-white font-medium rounded-lg transition"
                            >
                                {loading ? 'Verifying...' : 'Login'}
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        );
    }

    function GateConfigEditor() {
        const [isAuthenticated, setIsAuthenticated] = useState(false);
        const [config, setConfig] = useState({ proxyProtocol: true, routes: [] });
        const [loading, setLoading] = useState(false);
        const [saving, setSaving] = useState(false);
        const [message, setMessage] = useState('');
        const [expandedRoutes, setExpandedRoutes] = useState({});

        const handleLogin = () => {
            setIsAuthenticated(true);
            loadConfig();
        };

        const handleLogout = () => {
            authToken = null;
            setIsAuthenticated(false);
        };

        const loadConfig = async () => {
            setLoading(true);
            try {
                const response = await fetch('/api/config', {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                setConfig(data);
                setMessage('Config loaded');
            } catch (error) {
                setMessage('Error: ' + error.message);
            }
            setLoading(false);
        };

        const saveConfig = async () => {
            setSaving(true);
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(config)
                });
                setMessage(response.ok ? 'Saved' : 'Error saving');
            } catch (error) {
                setMessage('Error: ' + error.message);
            }
            setSaving(false);
        };

        const addRoute = () => {
            setConfig({
                ...config,
                routes: [...config.routes, { host: '', backend: '', strategy: 'sequential', cachePingTTL: '3m', modifyVirtualHost: false, fallback: null }]
            });
        };

        const removeRoute = (index) => {
            setConfig({ ...config, routes: config.routes.filter((_, i) => i !== index) });
        };

        const updateRoute = (index, field, value) => {
            const newRoutes = [...config.routes];
            newRoutes[index][field] = value;
            setConfig({ ...config, routes: newRoutes });
        };

        const toggleFallback = (index) => {
            const newRoutes = [...config.routes];
            newRoutes[index].fallback = newRoutes[index].fallback ? null : { motd: '', versionName: '', versionProtocol: -1 };
            setConfig({ ...config, routes: newRoutes });
        };

        const updateFallback = (index, field, value) => {
            const newRoutes = [...config.routes];
            if (!newRoutes[index].fallback) newRoutes[index].fallback = {};
            newRoutes[index].fallback[field] = value;
            setConfig({ ...config, routes: newRoutes });
        };

        if (!isAuthenticated) return <LoginScreen onLogin={handleLogin} />;

        if (loading) {
            return (
                <div className="min-h-screen bg-black text-white flex items-center justify-center">
                    <RefreshCw className="w-12 h-12 animate-spin" />
                </div>
            );
        }

        return (
            <div className="min-h-screen bg-black text-white p-6">
                <div className="max-w-6xl mx-auto">
                    <div className="mb-8 flex justify-between items-center">
                        <div>
                            <h1 className="text-3xl font-bold mb-1">Gate Config</h1>
                            <p className="text-neutral-500 text-sm">Minecraft Proxy Routes</p>
                        </div>
                        <button onClick={handleLogout} className="flex items-center gap-2 px-4 py-2 bg-neutral-800 hover:bg-neutral-700 rounded-lg transition text-sm">
                            <LogOut /> Logout
                        </button>
                    </div>

                    {message && (
                        <div className="mb-6 p-3 bg-neutral-900 border border-neutral-800 rounded-lg text-sm text-neutral-400">
                            {message}
                        </div>
                    )}

                    <div className="mb-6 p-4 bg-neutral-900 rounded-lg border border-neutral-800">
                        <label className="flex items-center cursor-pointer">
                            <input type="checkbox" checked={config.proxyProtocol} onChange={() => setConfig({ ...config, proxyProtocol: !config.proxyProtocol })} className="w-4 h-4 mr-3" />
                            <span className="text-sm font-medium">Proxy Protocol</span>
                        </label>
                    </div>

                    <div className="mb-6">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-xl font-bold">Routes</h2>
                            <button onClick={addRoute} className="flex items-center gap-2 px-4 py-2 bg-neutral-800 hover:bg-neutral-700 rounded-lg transition text-sm">
                                <Plus /> Add
                            </button>
                        </div>

                        <div className="space-y-3">
                            {config.routes.map((route, index) => (
                                <div key={index} className="bg-neutral-900 rounded-lg border border-neutral-800 p-4">
                                    <div className="flex gap-4">
                                        <div className="flex-1 space-y-3">
                                            <input
                                                type="text"
                                                value={route.host}
                                                onChange={(e) => updateRoute(index, 'host', e.target.value)}
                                                placeholder="Host (e.g., play.example.com)"
                                                className="w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:border-neutral-600 text-white text-sm"
                                            />
                                            <input
                                                type="text"
                                                value={route.backend}
                                                onChange={(e) => updateRoute(index, 'backend', e.target.value)}
                                                placeholder="Backend (e.g., 10.0.0.1:25565)"
                                                className="w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:border-neutral-600 text-white text-sm"
                                            />

                                            <button onClick={() => setExpandedRoutes({ ...expandedRoutes, [index]: !expandedRoutes[index] })} className="flex items-center gap-1 text-neutral-500 hover:text-neutral-400 text-xs">
                                                <ChevronDown /> {expandedRoutes[index] ? 'Hide' : 'Show'} Options
                                            </button>

                                            {expandedRoutes[index] && (
                                                <div className="space-y-3 pt-3 border-t border-neutral-800">
                                                    <select value={route.strategy || 'sequential'} onChange={(e) => updateRoute(index, 'strategy', e.target.value)} className="w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white text-sm">
                                                        <option value="sequential">Sequential</option>
                                                        <option value="random">Random</option>
                                                        <option value="round-robin">Round Robin</option>
                                                        <option value="least-connections">Least Connections</option>
                                                        <option value="lowest-latency">Lowest Latency</option>
                                                    </select>
                                                    <input type="text" value={route.cachePingTTL || '3m'} onChange={(e) => updateRoute(index, 'cachePingTTL', e.target.value)} placeholder="Cache TTL (3m)" className="w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white text-sm" />
                                                    <label className="flex items-center text-sm">
                                                        <input type="checkbox" checked={route.modifyVirtualHost || false} onChange={(e) => updateRoute(index, 'modifyVirtualHost', e.target.checked)} className="w-4 h-4 mr-2" />
                                                        Modify Virtual Host
                                                    </label>
                                                    <label className="flex items-center text-sm">
                                                        <input type="checkbox" checked={!!route.fallback} onChange={() => toggleFallback(index)} className="w-4 h-4 mr-2" />
                                                        Fallback Status
                                                    </label>
                                                    {route.fallback && (
                                                        <textarea value={route.fallback.motd || ''} onChange={(e) => updateFallback(index, 'motd', e.target.value)} placeholder="Fallback MOTD" rows="2" className="w-full px-3 py-2 bg-neutral-800 border border-neutral-700 rounded text-sm text-white" />
                                                    )}
                                                </div>
                                            )}
                                        </div>
                                        <button onClick={() => removeRoute(index)} className="p-2 text-neutral-500 hover:text-neutral-400">
                                            <Trash2 />
                                        </button>
                                    </div>
                                </div>
                            ))}

                            {config.routes.length === 0 && (
                                <div className="p-8 bg-neutral-900 rounded-lg text-center text-neutral-600 border border-neutral-800">
                                    No routes configured
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="flex gap-3">
                        <button onClick={saveConfig} disabled={saving} className="flex items-center gap-2 px-6 py-3 bg-neutral-800 hover:bg-neutral-700 disabled:bg-neutral-900 rounded-lg transition font-medium text-sm">
                            <Save /> {saving ? 'Saving...' : 'Save'}
                        </button>
                        <button onClick={loadConfig} className="flex items-center gap-2 px-6 py-3 bg-neutral-900 hover:bg-neutral-800 rounded-lg transition text-sm">
                            <RefreshCw /> Reload
                        </button>
                    </div>
                </div>
            </div>
        );
    }

    ReactDOM.render(<GateConfigEditor />, document.getElementById('root'));
</script>
</body>
</html>