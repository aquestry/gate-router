<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gate Lite Config Editor</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black">
<div id="root"></div>
<script type="text/babel" data-presets="env,react">
    const { useState } = React;

    let authToken = null;

    const STRATEGIES = [
        "sequential",
        "random",
        "round-robin",
        "least-connections",
        "lowest-latency",
    ];
    const TTL_REGEX = /^\d+(s|m|h|d)$/i;
    const EMPTY_FALLBACK = {
        motd: "",
        versionName: "",
        versionProtocol: "",
        maxPlayers: "",
        onlinePlayers: "",
    };

    const Plus = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" strokeWidth="2">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
    );

    const Trash2 = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" strokeWidth="2">
            <polyline points="3 6 5 6 21 6" />
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4
                     a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
        </svg>
    );

    const Save = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" strokeWidth="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11
                     a2 2 0 0 1-2 2z" />
            <polyline points="17 21 17 13 7 13 7 21" />
            <polyline points="7 3 7 8 15 8" />
        </svg>
    );

    const RefreshCw = ({ className = "" }) => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" strokeWidth="2" className={className}>
            <polyline points="23 4 23 10 17 10" />
            <polyline points="1 20 1 14 7 14" />
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10
                     M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
        </svg>
    );

    const ChevronDown = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" strokeWidth="2">
            <polyline points="6 9 12 15 18 9" />
        </svg>
    );

    const Lock = () => (
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" strokeWidth="2">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
        </svg>
    );

    const LogOut = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" strokeWidth="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
        </svg>
    );

    const toList = (value) => {
        if (Array.isArray(value)) {
            return value.map((item) => String(item).trim()).filter(Boolean);
        }
        return String(value || "")
            .replace(/\n/g, ",")
            .split(",")
            .map((item) => item.trim())
            .filter(Boolean);
    };

    const collapseList = (value) => {
        const parts = toList(value);
        if (!parts.length) return "";
        return parts.length === 1 ? parts[0] : parts;
    };

    const formatListForInput = (value) => {
        if (Array.isArray(value)) return value.join(", ");
        return value || "";
    };

    const parseInteger = (value, { allowNegative = false } = {}) => {
        if (value === "" || value === null || value === undefined) return null;
        const parsed = Number(value);
        if (!Number.isInteger(parsed)) return NaN;
        if (!allowNegative && parsed < 0) return NaN;
        return parsed;
    };

    const inputClass = (hasError) =>
        `w-full px-3 py-2 bg-neutral-800 rounded-lg focus:outline-none text-white text-sm ${
            hasError
                ? "border border-red-600 focus:border-red-400"
                : "border border-neutral-700 focus:border-neutral-600"
        }`;

    function LoginScreen({ onLogin }) {
        const [password, setPassword] = useState("");
        const [error, setError] = useState("");
        const [loading, setLoading] = useState(false);

        const handleSubmit = async (e) => {
            e.preventDefault();
            setLoading(true);
            setError("");

            try {
                const response = await fetch("/api/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ password }),
                });
                const data = await response.json().catch(() => ({}));

                if (response.ok) {
                    authToken = data.token;
                    onLogin();
                } else {
                    setError(data.error || "Invalid password");
                }
            } catch (err) {
                setError("Connection error");
            }
            setLoading(false);
        };

        return (
            <div className="min-h-screen bg-black flex items-center justify-center p-6">
                <div className="w-full max-w-md">
                    <div className="bg-neutral-900 rounded-lg p-8 border border-neutral-800">
                        <div className="flex justify-center mb-6">
                            <div className="w-16 h-16 bg-neutral-800 rounded-full flex items-center justify-center">
                                <Lock />
                            </div>
                        </div>
                        <h1 className="text-2xl font-bold text-center mb-2 text-white">
                            Gate Config
                        </h1>
                        <p className="text-neutral-500 text-center mb-6 text-sm">
                            Authentication Required
                        </p>

                        <form onSubmit={handleSubmit}>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                placeholder="Password"
                                className="w-full px-4 py-3 bg-neutral-800 border border-neutral-700 rounded-lg focus:outline-none focus:border-neutral-600 text-white mb-4"
                                autoFocus
                            />

                            {error && (
                                <div className="mb-4 p-3 bg-neutral-800 border border-neutral-700 rounded-lg text-neutral-400 text-sm">
                                    {error}
                                </div>
                            )}

                            <button
                                type="submit"
                                disabled={loading || !password}
                                className="w-full py-3 bg-neutral-700 hover:bg-neutral-600 disabled:bg-neutral-800 text-white font-medium rounded-lg transition"
                            >
                                {loading ? "Verifying..." : "Login"}
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        );
    }

    // Simple App wrapper so we can later swap in GateConfigEditor
    function App() {
        const [loggedIn, setLoggedIn] = useState(false);

        if (!loggedIn) {
            return <LoginScreen onLogin={() => setLoggedIn(true)} />;
        }

        return (
            <div className="min-h-screen bg-black text-white p-6">
                <h1 className="text-2xl font-bold mb-4">Gate Lite Config Editor</h1>
                <p className="text-neutral-400">
                    Logged in. TODO: GateConfigEditor goes here.
                </p>
            </div>
        );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
</script>
</body>
</html>
