<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gate Lite Config Editor</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
    const { useState, useEffect } = React;

    // Icons
    const Plus = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
    );

    const Trash2 = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
    );

    const Save = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
    );

    const RefreshCw = ({ className }) => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
            <polyline points="23 4 23 10 17 10"></polyline>
            <polyline points="1 20 1 14 7 14"></polyline>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
        </svg>
    );

    const ChevronDown = () => (
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
    );

    function GateConfigEditor() {
        const [config, setConfig] = useState({
            proxyProtocol: true,
            routes: []
        });
        const [loading, setLoading] = useState(true);
        const [saving, setSaving] = useState(false);
        const [message, setMessage] = useState('');
        const [expandedRoutes, setExpandedRoutes] = useState({});

        const loadConfig = async () => {
            setLoading(true);
            try {
                const response = await fetch('/api/config');
                const data = await response.json();
                setConfig(data);
                setMessage('Config loaded successfully');
            } catch (error) {
                setMessage('Error loading config: ' + error.message);
            }
            setLoading(false);
        };

        const saveConfig = async () => {
            setSaving(true);
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                if (response.ok) {
                    setMessage('Config saved successfully! Gate will auto-reload.');
                } else {
                    setMessage('Error saving config');
                }
            } catch (error) {
                setMessage('Error saving config: ' + error.message);
            }
            setSaving(false);
        };

        useEffect(() => {
            loadConfig();
        }, []);

        const addRoute = () => {
            setConfig({
                ...config,
                routes: [...config.routes, {
                    host: '',
                    backend: '',
                    strategy: 'sequential',
                    cachePingTTL: '3m',
                    modifyVirtualHost: false,
                    fallback: null
                }]
            });
        };

        const removeRoute = (index) => {
            setConfig({
                ...config,
                routes: config.routes.filter((_, i) => i !== index)
            });
        };

        const updateRoute = (index, field, value) => {
            const newRoutes = [...config.routes];
            newRoutes[index][field] = value;
            setConfig({ ...config, routes: newRoutes });
        };

        const updateFallback = (index, field, value) => {
            const newRoutes = [...config.routes];
            if (!newRoutes[index].fallback) {
                newRoutes[index].fallback = {};
            }
            newRoutes[index].fallback[field] = value;
            setConfig({ ...config, routes: newRoutes });
        };

        const toggleFallback = (index) => {
            const newRoutes = [...config.routes];
            if (newRoutes[index].fallback) {
                newRoutes[index].fallback = null;
            } else {
                newRoutes[index].fallback = {
                    motd: '',
                    versionName: '',
                    versionProtocol: -1
                };
            }
            setConfig({ ...config, routes: newRoutes });
        };

        const toggleProxyProtocol = () => {
            setConfig({ ...config, proxyProtocol: !config.proxyProtocol });
        };

        const toggleExpanded = (index) => {
            setExpandedRoutes({
                ...expandedRoutes,
                [index]: !expandedRoutes[index]
            });
        };

        if (loading) {
            return (
                <div className="min-h-screen bg-gray-900 text-white flex items-center justify-center">
                    <div className="text-center">
                        <RefreshCw className="w-12 h-12 animate-spin mx-auto mb-4" />
                        <p>Loading configuration...</p>
                    </div>
                </div>
            );
        }

        return (
            <div className="min-h-screen bg-gray-900 text-white p-6">
                <div className="max-w-6xl mx-auto">
                    <div className="mb-8">
                        <h1 className="text-3xl font-bold mb-2">Gate Lite Config Editor</h1>
                        <p className="text-gray-400">Manage your Minecraft proxy routes with advanced features</p>
                    </div>

                    {message && (
                        <div className="mb-6 p-4 bg-blue-900 border border-blue-700 rounded-lg">
                            {message}
                        </div>
                    )}

                    <div className="mb-6 p-6 bg-gray-800 rounded-lg">
                        <label className="flex items-center cursor-pointer">
                            <input
                                type="checkbox"
                                checked={config.proxyProtocol}
                                onChange={toggleProxyProtocol}
                                className="w-5 h-5 mr-3"
                            />
                            <div>
                                <span className="text-lg font-semibold">Proxy Protocol</span>
                                <p className="text-sm text-gray-400">Enable HAProxy PROXY protocol support</p>
                            </div>
                        </label>
                    </div>

                    <div className="mb-6">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-2xl font-bold">Routes</h2>
                            <button
                                onClick={addRoute}
                                className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition"
                            >
                                <Plus />
                                Add Route
                            </button>
                        </div>

                        <div className="space-y-4">
                            {config.routes.map((route, index) => (
                                <div key={index} className="bg-gray-800 rounded-lg overflow-hidden">
                                    <div className="p-6">
                                        <div className="flex gap-4 items-start">
                                            <div className="flex-1 space-y-4">
                                                {/* Host */}
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">
                                                        Host
                                                        <span className="text-gray-400 ml-2 text-xs">
                                                                (e.g., example.com, *.example.com, or [host1, host2])
                                                            </span>
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value={route.host}
                                                        onChange={(e) => updateRoute(index, 'host', e.target.value)}
                                                        placeholder="example.com"
                                                        className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500"
                                                    />
                                                </div>

                                                {/* Backend */}
                                                <div>
                                                    <label className="block text-sm font-medium mb-2">
                                                        Backend(s)
                                                        <span className="text-gray-400 ml-2 text-xs">
                                                                (e.g., 10.0.0.1:25565 or [backend1:25565, backend2:25566])
                                                            </span>
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value={route.backend}
                                                        onChange={(e) => updateRoute(index, 'backend', e.target.value)}
                                                        placeholder="10.0.0.1:25565"
                                                        className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500"
                                                    />
                                                </div>

                                                {/* Advanced Options Toggle */}
                                                <button
                                                    onClick={() => toggleExpanded(index)}
                                                    className="flex items-center gap-2 text-blue-400 hover:text-blue-300 text-sm"
                                                >
                                                    <ChevronDown />
                                                    {expandedRoutes[index] ? 'Hide' : 'Show'} Advanced Options
                                                </button>

                                                {/* Advanced Options */}
                                                {expandedRoutes[index] && (
                                                    <div className="space-y-4 pt-4 border-t border-gray-700">
                                                        {/* Load Balancing Strategy */}
                                                        <div>
                                                            <label className="block text-sm font-medium mb-2">
                                                                Load Balancing Strategy
                                                                <span className="text-gray-400 ml-2 text-xs">
                                                                        (for multiple backends)
                                                                    </span>
                                                            </label>
                                                            <select
                                                                value={route.strategy || 'sequential'}
                                                                onChange={(e) => updateRoute(index, 'strategy', e.target.value)}
                                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500"
                                                            >
                                                                <option value="sequential">Sequential (Default)</option>
                                                                <option value="random">Random</option>
                                                                <option value="round-robin">Round Robin</option>
                                                                <option value="least-connections">Least Connections</option>
                                                                <option value="lowest-latency">Lowest Latency</option>
                                                            </select>
                                                        </div>

                                                        {/* Cache Ping TTL */}
                                                        <div>
                                                            <label className="block text-sm font-medium mb-2">
                                                                Cache Ping TTL
                                                                <span className="text-gray-400 ml-2 text-xs">
                                                                        (e.g., 3m, 180s, or -1s to disable)
                                                                    </span>
                                                            </label>
                                                            <input
                                                                type="text"
                                                                value={route.cachePingTTL || '3m'}
                                                                onChange={(e) => updateRoute(index, 'cachePingTTL', e.target.value)}
                                                                placeholder="3m"
                                                                className="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:border-blue-500"
                                                            />
                                                        </div>

                                                        {/* Modify Virtual Host */}
                                                        <div>
                                                            <label className="flex items-center cursor-pointer">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={route.modifyVirtualHost || false}
                                                                    onChange={(e) => updateRoute(index, 'modifyVirtualHost', e.target.checked)}
                                                                    className="w-5 h-5 mr-3"
                                                                />
                                                                <div>
                                                                    <span className="text-sm font-semibold">Modify Virtual Host</span>
                                                                    <p className="text-xs text-gray-400">Rewrite handshake host to backend address</p>
                                                                </div>
                                                            </label>
                                                        </div>

                                                        {/* Fallback Status */}
                                                        <div>
                                                            <label className="flex items-center cursor-pointer mb-3">
                                                                <input
                                                                    type="checkbox"
                                                                    checked={!!route.fallback}
                                                                    onChange={() => toggleFallback(index)}
                                                                    className="w-5 h-5 mr-3"
                                                                />
                                                                <div>
                                                                    <span className="text-sm font-semibold">Enable Fallback Status</span>
                                                                    <p className="text-xs text-gray-400">Show custom status when all backends are offline</p>
                                                                </div>
                                                            </label>

                                                            {route.fallback && (
                                                                <div className="ml-8 space-y-3">
                                                                    <div>
                                                                        <label className="block text-xs font-medium mb-1 text-gray-300">
                                                                            MOTD (Message of the Day)
                                                                        </label>
                                                                        <textarea
                                                                            value={route.fallback.motd || ''}
                                                                            onChange={(e) => updateFallback(index, 'motd', e.target.value)}
                                                                            placeholder="§cServer is offline\n§eTry again later!"
                                                                            rows="2"
                                                                            className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm focus:outline-none focus:border-blue-500"
                                                                        />
                                                                    </div>
                                                                    <div className="grid grid-cols-2 gap-3">
                                                                        <div>
                                                                            <label className="block text-xs font-medium mb-1 text-gray-300">
                                                                                Version Name
                                                                            </label>
                                                                            <input
                                                                                type="text"
                                                                                value={route.fallback.versionName || ''}
                                                                                onChange={(e) => updateFallback(index, 'versionName', e.target.value)}
                                                                                placeholder="§cOffline"
                                                                                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm focus:outline-none focus:border-blue-500"
                                                                            />
                                                                        </div>
                                                                        <div>
                                                                            <label className="block text-xs font-medium mb-1 text-gray-300">
                                                                                Version Protocol
                                                                            </label>
                                                                            <input
                                                                                type="number"
                                                                                value={route.fallback.versionProtocol || -1}
                                                                                onChange={(e) => updateFallback(index, 'versionProtocol', parseInt(e.target.value))}
                                                                                className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm focus:outline-none focus:border-blue-500"
                                                                            />
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                            <button
                                                onClick={() => removeRoute(index)}
                                                className="p-2 text-red-400 hover:text-red-300 hover:bg-red-900/20 rounded-lg transition"
                                                title="Remove route"
                                            >
                                                <Trash2 />
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}

                            {config.routes.length === 0 && (
                                <div className="p-12 bg-gray-800 rounded-lg text-center text-gray-400">
                                    No routes configured. Click "Add Route" to create one.
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="flex gap-4">
                        <button
                            onClick={saveConfig}
                            disabled={saving}
                            className="flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded-lg transition font-semibold"
                        >
                            <Save />
                            {saving ? 'Saving...' : 'Save Config'}
                        </button>
                        <button
                            onClick={loadConfig}
                            className="flex items-center gap-2 px-6 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg transition"
                        >
                            <RefreshCw />
                            Reload
                        </button>
                    </div>

                    <div className="mt-8 p-4 bg-gray-800 border border-gray-700 rounded-lg text-sm text-gray-400">
                        <p className="mb-2"><strong>Note:</strong> Gate automatically reloads the config when saved.</p>
                        <p className="mb-2"><strong>Load Balancing:</strong> Sequential (default), Random, Round-Robin, Least-Connections, Lowest-Latency</p>
                        <p className="mb-2"><strong>Cache TTL:</strong> Use 3m (3 minutes), 180s (180 seconds), or -1s to disable caching</p>
                        <p>Use Minecraft color codes in fallback MOTD: §c (red), §e (yellow), §a (green), etc.</p>
                    </div>
                </div>
            </div>
        );
    }

    ReactDOM.render(<GateConfigEditor />, document.getElementById('root'));
</script>
</body>
</html>